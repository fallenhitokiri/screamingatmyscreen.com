<?xml version="1.0" encoding="utf-8" ?>

<rss version="2.0">

    <channel>
        <title>screaming at my screen!</title>
        <link>http://screamingatmyscreen.com/</link>
        <description>what's hot</description>
        <language>en-en</language>
        <copyright>you!</copyright>
        <pubDate>2013-10-04 19:09:04.252454 GMT</pubDate>

        
            
            <item>
                <title>Learning Scala - Week 2</title>
                <link>http://screamingatmyscreen.com/2013/10/learning-scala-week/</link>
                <description><p>I am a bit late with my week two summary but let's do it anyway. Week three will be ready on Sunday. I stopped attending the Coursera class. I fought against the tools and I even managed to actually learn some Scala.
<!--MORE--></p>

<p>Why did I stop the course? Well, first it is absolutely not the way how I can effectively learn a new language. It just doesn't work for me. Second I was a bit disappointed by it. I will still watch the video instructions to know if I am right about it but currently I feel like there is some part of Scala, some part of functional programming in every weeks lectures and at the end of the day, without any prior knowledge, you know nothing about both of them. Maybe it is also just my first impression and I'm wrong.</p>

<p>Some people argued that I should still complete it to get the certificate. First: I do not really care about it. I do not need papers, or PDFs, to show me what I can do. Second: It will not be accepted by any university as prove that I am able to do something or learned it. And I think most, if not all, potential employers and clients also do not care about a piece of paper from an online course, especially if I can just demonstrate the skills.</p>

<p>The tools are still a bit strange. You know, life is pretty easy right now. <code>python foo.py</code>, <code>go run foo.py</code>, <code>node foo.js</code>. One file. You can have this with Scala, too. You have the usual Java-ish stuff kit compile and than run. You have the same Java-ish stuff with specifying the classes. If you ever worked with Java you know how it will be working with Scala. Beside that you also get some nice things like an interactive shell.</p>

<p>Working with Scala, right now, after the first tutorials is not really spectacular. I only made it through the basics to get an understanding of the syntax, parts of the library and some best practices. I think the "real fun" starts after I got through those things. Right now it doesn't make a big difference if I am writing Scala or Go for example. I believe line count is about the same.</p>

<p>What made me chuckle is the fact that using <code>MutableList</code> threw a style warning that I should not use it. I'm not sure what the Coursera system used to check the code style and quality. But throwing an error for using something from the standard library is just hilarious if you ask me. "Hey - I know the people who wrote the language gave you this tool. But I think you should not use it. Because reasons (actually: mutability). Nah, they surely do not just make it unavailable or throw an error if you use it directly or warn you for using it. Thats my job. You really should not use it."</p>

<p>Sadly I did not get as much done as I expected till last Sunday. But this week was a bit more productive - update will be ready on Sunday.</p>
</description>
                <pubDate>2013-10-04 19:08:00</pubDate>
            </item>
            
        
            
            <item>
                <title>Learning Scala - Week 1</title>
                <link>http://screamingatmyscreen.com/2013/9/learning-scala-week/</link>
                <description><p>I decided to learn Scala. It was more a spontaneous decision than well thought out. I have heard many good things about it, it seems to do a decent job at Twitter, other start-ups and established companies, it runs on top of the JVM and Coursera just started a course "Functional Programming Principles in Scala". I will write a short recap about my journey every weekend.
<!--MORE--></p>

<p>This are basically two new things at the same time for me. Coursera and Scala. Functional programming is not something new to me but I never used a purely functional programming language or focused on learning everything about it. I am aware how it works, the advantages and disadvantages and how to use it if necessary.</p>

<p>Finishing the first week, I have not seen much of Scala. Defining a function, some recursion, nothing spectacular. This is not necessarily bad. A lot of time was used to explain fundamentals of functional programming and I believe someone who has no experience with it really needs those explanations before starting with anything else. And I have high hopes in this course, especially since we are talking about Martin Odersky, who, beside the one - or one of the people - who came up with a programming language could explain the fundamental ideas better?</p>

<p>The homework looks ridiculous compared to what you learn. It would be interesting to see someone without programming background trying to complete the assignments - if you are fitting in this category or know someone I would love to hear your thoughts. As far as I can tell you get enough hints but concentrating on Scala, deciding how to implement something and not knowing if the problem with your implementation is caused by a wrong implementation or if the solution you came up with is wrong can surely be confusing. Maybe the course is meant for people with a math and / or programming background but currently I do not believe it is well suited for beginners.</p>

<p>Scala runs on top of the JVM which means I had, for the first time in many years, a reason to install Java on my notebook. If you follow the instructions closely you will end up installing Eclipse. I do not want this to become a discussion of IDEs or why, of all IDEs I have worked with, Eclipse is the last one I would want to use. </p>

<p>Something that currently did not happen - and I have seen the same thing in many Java books - is an explanation how you setup a project, file system structure and run it using command line tools. Maybe it will follow in a later lesson and was just skipped for simplicity, at least I hope so. I have seen to many people not being able to run a Java project when you take away their IDE with explanations ranging from "I never needed to do this" to "let the sysops guys handle this, it is not my job". In my opinion this is a lack of base knowledge.</p>

<p>The material for the second week looks promising. I hope to talk a bit more about Scala and less about everything else next week.</p>
</description>
                <pubDate>2013-09-22 20:35:00</pubDate>
            </item>
            
        
            
            <item>
                <title>Sublime Text as Python IDE - jedi</title>
                <link>http://screamingatmyscreen.com/2013/9/sublime-text-as-python-ide-jedi/</link>
                <description><p>I used Sublime Text exclusively for the last two weeks. The major drawback, beside the not really native user interface, was the way jedi works. After tweeting that the integration in vim using YouCompleteMe is way better I received the question how to properly configure Sublime Text to use jedi - let me give you a short walkthrough.
<!--MORE--></p>

<p>If you are not sure why you want <a href="https://github.com/davidhalter/jedi">jedi</a> - believe me, you do - let me show you two screenshots with and without jedi. Without jedi editing a file looks like this</p>

<p><img src="nojedi1.gif" alt="nojedi1" />
<img src="nojedi2.gif" alt="nojedi2" /></p>

<p>Now if we configure jedi properly and it looks like this</p>

<p><img src="jedi1.gif" alt="jedi1" />
<img src="jedi2.gif" alt="jedi2" /></p>

<p>I don't know how you work and what your preferences are, but I prefer a working autocompletion and not one who only completes words in the same file or open files - I'm looking at you TextMate. Makes it a lot easier working on larger codebases if you do not have to remember every single class attribute, method and argument.</p>

<p>First have to install <a href="https://github.com/srusskih/SublimeJEDI">SublimeJedi</a>. It looks like the people who asked why it isn't working for them are either using virtualenv or never used the projects functionality and don't know how to configure a project in Sublime Text. This are basically the only two options I can think of.</p>

<p>Open Sublime Text and the project you are working on and save it as a project using <code>Project -&gt; Save Project asâ€¦</code>. The only thing left to do is editing your project file using <code>Project -&gt; Edit Project</code>. The most basic configuration looks like this</p>

<pre><code>{
    "folders":
    [
            {
                  "follow_symlinks": true,
                  "path": "my-project"
            }
     ],
    "settings": {
        "python_interpreter_path": "/Users/tizi/my-project/venv/bin/python"
    }
}
</code></pre>

<p>Now jedi will use the Python interpreter from the virtual environment I created in <code>my-project/venv</code>. It will also index and complete all packages you install in your virtual environment. For more configuration options I suggest reading the documentation of SublimeJedi. Now that you have understood the configuration is should be fairly easy to add the additional options if needed.</p>
</description>
                <pubDate>2013-09-14 18:34:00</pubDate>
            </item>
            
        
            
            <item>
                <title>Share buttons and your readers</title>
                <link>http://screamingatmyscreen.com/2013/9/share-buttons-and-your-readers/</link>
                <description><p>We all know them. We all hate them for various reasons. But they will not go away and there are good reasons why they stick around. I am talking about those little buttons you see on many blog posts or news sites these days. Buttons to quickly share an article via many different social media sites. The problem is not that they exist or that people use them. The problem is that people most of the time do not understand the consequences and implementations. Let us talk about some things we should consider best practice.
<!--MORE--></p>

<p>Before we start with the implementation we should talk about the reasons for those buttons. Do they really increase shares, likes, pins and whatever else it is called? If you ask someone wit the letters S, E and O on his business card the answer will be "yes". I tried having a Twitter button below my posts and they were shared a lot more than without one. Does this prove anything? No. This is one blog with tech-savvy readers. The only thing you could state is that my readers seem to be lazy when it comes to sharing content. If it is just one click away they were more likely to do it than now.</p>

<p>If you include one is entirely up to you. But please do it "right" (â„¢). Yes, there is a right way to implement it. There is also a "a little bit less right" way, but this one is a lot easier.</p>

<p>A last note: I assume you care about your users and readers. If this is not the case just stop reading, you will waste your time.</p>

<h2>Why you should care</h2>

<p>I had a link in my Twitter timeline and wanted to read it. What did I see? Text. Good so far, as I was prepared to read something. What I was not prepared for was the fact that after some time a JavaScript will be done downloading and rendering and displays a button right in the middle of the viewport (which is not endless on a smartphone).</p>

<p><img src="social1.png" alt="desktop" /></p>

<p>Now you can start arguing that mobile users are a minority. This could be true for your blog, today, but I would not take bets that it stays this way. But the sad truth is that most of those sharing plugins are just entirely broken. Even bigger screens (not just slightly bigger as in tablet but bigger as in laptop or desktop screen) show the same thing: The button is rendered in the middle of the content.</p>

<p><img src="social2.png" alt="iphone" /></p>

<p>While this can be a minor annoyance on bigger screens it just plainly sucks on smaller ones. No matter how big the screen actually is I always find it irritating if there is something rendered in the middle of the content I want to read.</p>

<h2>The right way</h2>

<p>Guillermo Garron wrote an easy to follow <a href="http://www.garron.me/en/blog/provide-share-buttons-without-exposing-your-visitors.html">article</a> about the right way. The idea is pretty simple: Instead of including a JavaScript from a 3rd party you just add a link which opens the sharing form in the browser. You will not have the numbers how often an item was shared but since they are (most of the time) inaccurate anyway, it would not be a big deal for me.</p>

<p>'Why is this the right way?' you may ask. Excellent question. This way you do not include 3rd party JavaScripts in your site. You are not automatically giving the data of users visiting your site away to Twitter, Facebook and whoever else you include. It is not much, but it is a start to prevent the senseless data collecting going on.</p>

<p>Another advantage is that your site could load a bit faster. No additional JavaScript to be downloaded and rendered. No dependency on 3rd party servers which could be broken and not respond, blocking a connection. I know this is unlikely for those providers but history shows that it can happen.</p>

<h2>The not so right way</h2>

<p>I am aware of the fact that not everyone is willing to edit the template. Especially if one has never written one line of HTML and CSS. One way is to depend on 3rd party libraries. You still hand over your users data to someone but at least you can make sure your users can read your content without any annoying buttons popping up in the middle of the screen.</p>

<p>Smashing Magazine has <a href="http://wp.smashingmagazine.com/2012/02/22/25-social-media-plugins-wordpress/">a list</a> of some popular solutions with Wordpress integration. I am aware that there are other publishing platforms than Wordpress but it powers a fair share of the Internet and is a good example. Some of them also work on other platforms.</p>

<p>Sociable, Shareaholic and Sharebar do a decent job. I would suggest putting the share buttons at the end of your article. It is unlikely that users share your post before they have read it. At least I am not aware of a user who ever thought "wow, this article sucks but look at this sentence! Thank god there is a share button so I can share exactly this sentence right now, even if I will not read the rest of the article!".</p>

<p>So seriously, there are not many reasons for sharing icons who are always on the screen. If you have thousands of comments and people read those before sharing it can be a viable option. But I doubt this is the norm.</p>

<h2>It does not really matter</h2>

<p>Most of the time users will not care about the small details I talked about. But what many notice is if they can read the content you published, which took time and effort, or if parts of it are always overlapped by some social media icons which distract the reading experience. They care, if they can just read text or always have to scroll a bit more up or downwards to find the spot were the paragraph they want to read is not covered.</p>

<p>You can <a href="http://twitter.com/intent/tweet?url=http://screamingatmyscreen.com/2013/9/share-buttons-and-your-readers/&amp;text=Share buttons and your readers&amp;via=fallenhitokiri">share this post on Twitter</a> or <a href="https://news.ycombinator.com/item?id=6334895">discuss it on HackerNews</a>.</p>
</description>
                <pubDate>2013-09-05 17:51:00</pubDate>
            </item>
            
        
            
            <item>
                <title>The joy and pain of using a static site generator for private and client work</title>
                <link>http://screamingatmyscreen.com/2013/8/the-joy-and-pain-of-using-a-static-site-generator-for-private-and-client-work/</link>
                <description><p>Nearly two years ago I <a href="http://screamingatmyscreen.com/2011/12/and-here-comes-zenbo/">migrated</a> screaming at my screen to <a href="https://github.com/fallenhitokiri/drupan">drupan</a>, a static site generator I wrote. In the last two years I used drupan, custom build CMSs written in Django and Ruby on Rails and even Wordpress for different projects. And in the last two years I always asked myself if all the hype about static site generators is not just exactly that - a hype.
<!--MORE--></p>

<p>I believe the popularity of static site generators - let us call them SSG from here on - started with <a href="http://tom.preston-werner.com/2008/11/17/blogging-like-a-hacker.html">Tom Preston-Werner</a> and <a href="http://paulstamatiou.com/how-to-wordpress-to-jekyll">Paul Stamatiou</a> blogging about "blogging like a hacker" and moving their sites to <a href="https://github.com/mojombo/jekyll">Jekyll</a>. Scripts generating a entirely static site was nothing new. But at this time it was a countermovement to the trend that everybody wrote their own blog in ten minutes in the newest and hippest framework for web development.</p>

<p>We all enjoyed exploring new frameworks. What can Rails do what Django cannot? Why not going for TurboGears? Oh look, this one provides ajaxy-things out of the box! But what we got after the initial hype were blogs lacking features, requiring a lot of time to setup and maintain a server and some security related fiascos thanks to the missing experience of some or just flaws in the frameworks.</p>

<p>Going two steps back to static site generator. No matter how broken or disturbingly bad designed your static site generator is - your site is secure and performant. Messing up SSHd and a httpd only serving static content is a hard task after reading some tutorials, likely easily accessible in the wiki of the distribution running on a server. If there is one and not just some $2 shared hosting provider. And the workflow started to become simple again.</p>

<p>But this is hardly the whole story if you ask me. Not fighting against the doom of modern web - or what other people call it: WYSIWYG edit boxes - just writing your post, running a command and seeing it online. Not caring about a server anymore, if it can handle an article on the frontpage of HackerNews or if some exploit in a framework will be found and the server being target of a mass scan for vulnerable sites. Static site generators introduce many people to a new kind of mental calmness and spread some kind of zen-like blogging feeling.</p>

<h2>And than it began to crumble</h2>

<p>After two years with drupan, answering people who migrated their blogs and sites over, realizing client projects, helping other agencies who decided to use it for their clients and seeing new static site generators emerge in every language nearly every week I can say one thing for sure: If you go beyond just publishing they all suck.</p>

<p>If you generate you site locally on your laptop - beware Captain Obvious statement - you always need your laptop to publish something. You cannot just sit on a beach, take a photo and publish it. You cannot sit in StarBucks and publish a quick thought or share a link. I am aware that we are living in 2013. You share your photos on Instagram. But the images are tiny and a square. It is not meant for beautiful pictures. You share links on Twitter. But adding more than 130 characters is a pain. And the biggest bummer? You do not own your content.</p>

<p>There is another option. Your server generates the site for you after you upload new content. No matter if you use Dropbox, git or an email. What happens if you mistyped the layout for your post? You page will be broken for one or two minutes. What if your static site generator crashes? No log file, no way to recover the site without shell access. Even if this would be the last thing I am worried about. Even moving the generation to the server does not solve all the problems but introduces new ones.</p>

<p>And sometimes it is just annoying to generate your site. You post an article, submit it to Reddit and want to link to it? Generate your site. Found a spelling mistake? Generate your site. Want to add a short update to point our a particular interesting comment on Twitter? Regenerate the site. Found another spelling mistakeâ€¦ I think you got the point.</p>

<h3>Clients love fancy stuff like contact forms and outdated browsers</h3>

<p>If you do not do any client work let me tell you a tale of small business owners and how much they love Internet Explorer. If you have kids reading this you should probably send them out of the room so they will not crawl under your blanket in the middle of the night, shaking and telling you about their nightmare.</p>

<p>Clients love contact forms. They do not know why. Maybe they do not trust their customers to be able to copy a email address or just click on it. Maybe they think it is fancy. Maybe they think it looks enterprise-y. I am not sure. But it does not matter how or what arguments you bring in. Some of them would even be willing to pay 100% more hosting costs a month and the development of a custom CMS just to have a contact form. Stop shaking your head, I also could not believe it when I heard it.</p>

<p>Than there is Internet Explorer. I have a clause in my standard contract that IE is supported starting from version 9. Backward compatibility is given as long as reasonable but if any additional development time would be needed to support older browsers it will be added to the invoice. I explain this part. Clearly and in easy words. And after one or two weeks, at least in two out of ten cases, I get a call explaining that one customer called because the homepage does not look right or work as expected. And at exactly this point it is essential that the site works with Internet Explorer 2.</p>

<p>Now combine Internet Explorer and contact forms. I have a small service which accepts a form, stores it and sends a mail to the customer. Currently it servers as backend for ~20 domains. But thanks to the fact that it requires CORS it does not work with IE6 or 7. There is a redirect fallback but it is quite messy. And this is only a simple contact form. Imagine the pain of supporting something more complex.</p>

<p>The fact that you are reading this likely means you are not using Internet Explorer prior version to version 9 and can tell if something happens if you click a button. What if you build your site using a static site generator and an AJAX contact form and a potential client thinks he send you an email, offering the opportunity to work on a big project and you never receive the mail? Your client could be forced to use Windows XP and Internet Explorer in his office. Too bad, opportunity gone. I have seen a lot big projects migrating to static sites and JS on top of it. But sadly some people are left out.</p>

<p>And this is just the tip of the iceberg. Do not get me started on analytics. You either use a JavaScript based solution more than 60% of your readership blocks using noScript if you are blogging about technical things or you are back to logs provided by your httpd. No matter which solutions you choose, you will always miss something. The real fun starts when you have to conform EU regulations about cookies and exporting data.</p>

<p>Static sites, without an easy to use frontend, are most of the time, not suitable for client work. Even if they never do it, they want to option to edit content by themselves. Easily. Without the command line. Even if they have a contract so you are in charge of managing the site.</p>

<h2>We need a solution - but which one?</h2>

<p>Let us clear up some of the misconceptions about static site generators before we look at possible solutions. Even if the arguments why they rock are all valid - even I used them - we are now living in 2013. Things changed.</p>

<p>While it is true that most people gained a significant performance gain moving to an entirely static site it was more the inability to configure their old solution or add the most primitive type of caching to their custom tailored app. Even a Raspberry Pi can host a Wordpress blog and work just fine with <a href="https://news.ycombinator.com/item?id=4853912">a post</a> on the frontpage of HackerNews.</p>

<p>If you argue for using a static site generator I give you the security part. Anything accepting user input or running a different process than a httpd is more likely to be vulnerable than a static site. No point discussing about this one.</p>

<p>Before we talk about features we should make sure we talk about the same thing. I do not talk about a full featured CMS. A blog consists of - beware, Captain Obvious, again - blog posts and maybe one or two additional pages containing informations about the author and maybe showing some links and a short description about projects. I am looking for a different solution but I do not regret the last two years using a static site generator. I learned a lot about the workflow, the advantages, disadvantages and possibilities. The ease of mind using a statically generated site is great. Just write and publish. In my opinion this is how a blogging platform is supposed to look like. This is the reason why so many people enjoy publishing on Medium, Tumblr and founded <a href="http://tryghost.org">Ghost</a>.</p>

<p>This also brings me to a different point: The technical stuff should be hidden. I do not want to go to the command line and look how git is pushing a repository. I do not want to feel forced to have a quick look at my page, checking if the publishing process really worked as expected and if everything is alright. It should be about publishing your ideas, sharing your experiences and telling the world why your puppy is the most awesome thing since sliced bread.</p>

<p>It should not be a hosted service. But it should enable everyone to start a blog. There are many different cloud providers. A DigitalOcean VPS costs $5 a month. Heroku offers a free tier which is sufficient for a small blog. There has to be a "one click gives me a blog" option. If your father and mother who never used a computer but want to start a blog and if someone who just wrote his own operating system and wants to blog about it are equally satisfied with the solution we reached blog-nirvana. I am aware that this will likely not happen but you get the general direction.</p>

<p>There are many different ways how to produce content and the most important ones should be supported. Post by mail? Sure. Add a text file to your Dropbox account? Why not. A native application for your smartphone and tablet? Of course. But it should be equally simple to export all your content in formats which you can easily import in other solutions. Not being tied to a platform after you start using it is a real win.</p>

<p>Multi user support is great, but not necessary for a personal blog. I let my partner read most of my articles before I publish them. The workflow is pretty simple: Write, ask nicely, ask again, hand over your tablet, laptop or upload it to Dropbox. She does not need advanced editing rights, I do not need different versions to compare them after editing. Those features are great, sometimes even essential for a CMS but not for a blog.</p>

<p>Statistics should be build in, not added at second thought. Most of the time there are simple questions you want to answer. How many people view my blog daily or monthly? How many people read this post? At how many sites looked one visitor? Where do they all come from? There is, for your personal blog, no need for advanced geo-location tracking, saving everything starting with the IP address and outsourcing it to a company telling you that you are an idiot for believing in privacy.</p>

<p>Beauty and usability are either a core principle or do not exist. If you start making compromises you will end up with something that will remind you of Wordpress. Powerful features, posting something is simple but beware if you look beyond the edit box.</p>

<h2>The most interesting and entertaining part: Technical challenges</h2>

<p>How would you layout this project? What would be your design decisions? There are two basic concepts I have in my mind, one for a hosted service and one as a Wordpress kind of solution. From a technical point of view the hosted solution is a lot more exciting but I believe a lot less interesting for the general public.</p>

<h3>Hosted platform aka the more exciting solution</h3>

<p>This is just a quick thought how it could look. So it could be possible that I just did not think of some of the possible challenges or would run into problems implementing them.</p>

<p>In front of everything would be nginx doing exactly one thing: routing requests to a proxy written in golang, serving the right file depending on the domain and path, and the administrative interface written in Flask. Why Flask? Because the sites would just be checked out git repositories and drupan would handle the generation of static sites. I would try to keep the number of used languages down to a minimum.</p>

<p>The go proxy would push informations about every request to a temporary queue which synchronizes with a database for permanent storage after some small things like generating the md5 hash of an IP address - unique enough for analytics but some additional anonymity for visitors. The second task would be caching. No need to hit the HD or SSD with every request and cache invalidation can be handled with a drupan plugin.</p>

<p>An additional service could act as endpoint for AJAX post requests to provide some kind of contact form functionality. I have an SSH/git server written in Python, I was bored, somewhere in my backup which is able to fetch keys / associated repositories form a central backend and would enable a git based workflow. The administrative interface would act as central point to view and edit everything.</p>

<p>As I said - it is just a rough outline without going into details but I think you are able to see where this would be going. I like the basic idea but this also adds a lot of work besides writing the services. Making sure everything works nicely together and stays online is a burden I am currently not willing to carry. I already wrote about keeping pages of users online when I first <a href="http://screamingatmyscreen.com/2012/10/zenbo-zenbo-as-a-service-and-pricing/">talked about a hosted drupan</a> - at this time it was still called Zenbo - service. I am also not sure if we need yet another hosted blogging service. There are already enough out there doing a pretty good job, even if all of them lack one or two features.</p>

<h3>Something resembling what Wordpress used to be</h3>

<p>A simple application written in Flask or Sinatra, no need going for something big as Django or Ruby on Rails. Please remember that we are talking about a platform for blogging not a fully featured CMS. The solution should be simple, portable, easy to use and extend so developers also have a good time using it.</p>

<p>Writing it in Go would be exciting and likely - even if I would not use this as basis for my decision - score some trendy-points. But what about a solid ORM for SQL? What about a markdown converter and syntax highlighting? There are libraries but currently nothing as solid  and production proved as pygments or markdown2. A templating engine which does not suck and is well documented? Good luck. As much as I would love to use Go for some bigger projects the current lack or state of libraries is reason enough to stay with Python and Ruby. Implementing everything by myself is also out of question.</p>

<p>The most challenging part would be the storage backend. Supporting a $5 DigitalOcean VPS is pretty easy. An automated setup of nginx and, if used, a datastore, add virtualenv and you would be done. Nginx can serve the assets and uploads, since most of it is in cache the actual content could be saved in text files or SQLite but analytics is - in the first place - write heavy. Since I never looked into SQLite for parallel writes from multiple processes I'm not sure if it would be a good fit. Another options would be MongoDB. I heard people claim it works pretty well for document based content and logs or analytics.</p>

<p>Caching would be pretty trivial if we would only talk about one process of the app. But since it is likely that more than one is running using a dictionary will not work since invalidation would be a mess at best, more likely a disaster. So caching would require another service, likely Redis - just a personal preference over memcached - but this should be optional. Maybe a file based cache would work for small setups.</p>

<p>I am aware that SQLite and not using Redis or memcached is not what you would call best practice. But I want to see how far it is possible to go with the most trivial setup.</p>

<h3>The backend does not really matter</h3>

<p>If a new blogging platform is adopted by people it is - most of the time - not related to the backend but how much it gets out of the way of the user. Is it easy to setup? Does it require daily care and updates? How pleasant is the user interface? Are 3rd party services like Twitter or email easy to integrate?</p>

<p>There are many usability questions and many more arise if you add all the possible features. At some point you have to say goodbye to a feature for simplicity and usability or else you will not build something which resembles what Wordpress used to be but what Wordpress currently is. And let us be honest: no one needs a second Wordpress.</p>

<h2>Are static site generators a bad thing?</h2>

<p>No. They are still as great as they were from the beginning. I will also not stop developing drupan, even if I am currently far behind <a href="https://github.com/fallenhitokiri/drupan/issues/14">the schedule</a>. There are use cases, projects and clients where it will shine. But what using drupan for over two years taught me is that I expect something else from my blogging platform.</p>

<p>I would like to hear your thoughts about how a blogging platform should look like, what features it should provide and which it should not have. Feel free to <a href="mailto:timo@screamingatmyscreen.com">mail me</a> or join the discussion on <a href="https://news.ycombinator.com/item?id=6233059">HackerNews</a>.</p>

<p>If you like this article and the idea <a href="http://twitter.com/intent/tweet?url=http://screamingatmyscreen.com/2013/8/the-joy-and-pain-of-using-a-static-site-generator-for-private-and-client-work/&amp;text=The joy and pain of using a static site generator&amp;via=fallenhitokiri">share it on Twitter</a> or whatever social network you prefer, I would appreciate your help to get some exposure of this idea and more input.</p>
</description>
                <pubDate>2013-08-18 18:09:00</pubDate>
            </item>
            
        
            
            <item>
                <title>The state of Django and Ruby on Rails - one year later</title>
                <link>http://screamingatmyscreen.com/2013/8/the-state-of-django-and-ruby-on-rails-one-year-later/</link>
                <description><p>Back in 2012 I wrote a <a href="http://www.screamingatmyscreen.com/2012/2/business-decision-why-i-use-django-and-not-ruby-on-rails/">post</a> why my preferred choice for projects I realize with <a href="http://www.blazeit.de">Blaze IT</a> is Django and not Ruby on Rails. Since then it got a lot of attention and is still linked in some discussions and tweets today. People asked me for an update and if it is still relevant, so here we go.
<!--MORE--></p>

<p>Before we start let me clarify two things: </p>

<p>Both frameworks are a solid choice. If you cite this or my <a href="http://www.screamingatmyscreen.com/2012/2/business-decision-why-i-use-django-and-not-ruby-on-rails/">last post</a> as an "OMG look at these arguments, $foo is clearly superior" source you did not understand the intention and arguments very well. You will get stuff done with both frameworks and your app will be fully functional and working. The choice is basically arguing on a pretty high level of comfort and the differences are pretty small (but still existing) - so one framework can beat the other in certain circumstances. It is a situational and personal decision, not an universal truth.</p>

<p>A framework will not magically fix your existing project or build your app for you. It is one potential tool in your toolbox. If you are only building an API for a mobile app it can be a viable choice to skip the overhead of Django and RoR and just go for <a href="http://flask.pocoo.org/">Flask</a> or <a href="http://www.sinatrarb.com">Sinatra</a>. A framework is no magic. Well, RoR kind of is, but not the way you imagine.</p>

<p>Let us start going through the points we already discussed and add some new ones at the end of the list.</p>

<h3>Object Relational Mapper and migrations</h3>

<p>While RoR had this integrated for many years, Django will now get a full integration of South thanks to a kickstarter campaign. This will not only remove the necessity for a third party library but will also see a lot of improvements.</p>

<p>If you want to stay up to date with the development I suggest you start reading Andrew Godwins <a href="http://www.aeracode.org">blog</a>.</p>

<p>With those fixes and improvements it is a clear tie between the frameworks. Even if it is not integrated yet it will be there and depending on when your project starts it could be possible that you will already be able to use it.</p>

<h3>IDE</h3>

<p>Last year there were better IDEs available for Ruby than for Python. JetBrain, those who build a great Ruby IDE, also have <a href="http://www.jetbrains.com/pycharm/">PyCharm</a> which became better and better. Beside PyCharm many community driven projects emerged and are in a state between beta and "people use it to get stuff done".</p>

<p>I still prefer an editor with some convenient features on top but if you refuse to work on a codebase without an IDE you will likely be satisfied with options for both languages.</p>

<h3>Admin Interface</h3>

<p>Yes Django ships an admin interface and I told you it is okay to use it. This still stands. But it is not as unique as people believe. There are gems for RoR which provide the same functionality with the same comfort. It is not an unique feature.</p>

<p>Another thing I see discussed often is people using is extensively for everything and everyone. If you build a customer facing project you will have to build a new interface. There is no way around this. The existing interfaces are great if you know the app and do some maintenance but you do not want to expose them to users.</p>

<p>The lack of comfort, a clear workflow and the security implications are more than enough reasons that you invest some time into building something your users will love.</p>

<h3>Deployment</h3>

<p>There are now enough options for both languages and frameworks to save you the pain of running your own server. And if you prefer to do it anyway you will find enough tools to make it dead simple and comfortable. You will not gain any major advantages choosing one framework over another.</p>

<h3>Hiring</h3>

<p>More and more popular projects and start-ups use Django, like Pinterest and Instagram (just to name two of the biggest). Many developers started considering Django as a viable option building something. RoR still outperforms Django in the number of available jobs and talented devs though.</p>

<h3>Community</h3>

<p>I do not believe there is one month without a Ruby or Rails conference and most of them provide videos, slides and a lot of exposure for both, the language / framework and the speakers.</p>

<p>I have not seen the same for Python or Django. Of course there are conferences and great speakers but the hype around it and the exposure are by far not on the same level.</p>

<h2>New and noteworthy</h2>

<p>There are four things I did not talk about the last time but I received a lot of questions about those, thanks to recent incidents, events and blog posts.</p>

<p>Before we dive right in just the reminder, again, that both frameworks are nearly equal in both aspects, the statements are not true for every situation and you can shoot yourself in the foot with both of them - as you can with nearly anything.</p>

<h3>Updates</h3>

<p>Updating from one release to another is always troublesome. Both frameworks provide a documentation and tell you what is deprecated and what will be deprecated in a future release. If you do not read those announcements you cannot blame the framework.</p>

<p>According to my experience updating some bigger applications in both, Django and RoR, the last year, Django and Python are a lot less painful to update.</p>

<p>The biggest pain does not even come from the frameworks. Of course sometimes you have to adjust to some changes, likely a bit more often in Rails - but the last year is not fair for a comparison. Rails made the step from 3.x to 4. That's a major release while Django only saw a minor release update.</p>

<p>Here is a typical scenario what can happen with a Ruby project:
You run Ruby 1.93-p123. Your hosting provider only supports Ruby 1.02-p134 which is not compatible with Rails. So you change your hosting provider. Now you have a library which does not work with Ruby 1.93-p123 but only with 1.93-p122. It was not updated and used some obscure feature, you do not know if it will ever see an update. You start looking for alternatives and writing your own.</p>

<p>Some Ruby libraries which are quite popular come right from what I call "version ghetto".</p>

<p>Chances are high you will not encounter those problems if you start working on your app. But if it grows, if your start-up grows and if time passes chances are higher that you will see them a lot more often than a Python shop. It seems to get better.</p>

<p>This does not mean this cannot happen if you use Python. The adoption and support for Python 3 is a good example. And Python is not without its own flaws, making updates hard. The first time you see error messages because some encoding broke you will know what I mean.</p>

<h3>Security</h3>

<p>The last year we have seen many security incidents targeting the most basic things, proving default configurations as broken and showing how easy some apps can be attacked.</p>

<p>Breaking news: Every framework providing authorization, authentication, sessions,â€¦ you name it - is vulnerable and will screw up at some point.</p>

<p>But what we can also see is that RoR incidents are a lot more discussed and that the community comes up with fixes and work-arounds until the problem is officially fixed a bit faster and with more exposure.</p>

<p>If you use md5 to store passwords, do not sign cookies, do not restrict access to your administration interface and believe SQLinjections are some kind of story told by old people to scare young and hip developers you are likely the reason for one of the next discussions on HackerNews why people still do not understand the basics of web development, no matter which framework you use.</p>

<h3>Performance</h3>

<p>This is a pretty short point and I will not discuss it any further than posting <a href="http://www.techempower.com/benchmarks/#section=data-r6&amp;hw=i7&amp;test=db&amp;l=4qo&amp;p=2hwd2&amp;w=1g&amp;c=1&amp;d=6&amp;a=1&amp;f=so-0-0">this link to TechEmpower</a>. Search HN for discussion, look at the benchmark and understand them. Far better than anything I could write here right now.</p>

<h3>Growing with services</h3>

<p>One thing which is discussed often today is a service oriented architecture. You basically take parts of your application, put them in its own application and run them on another system so you can scale them easier.</p>

<p>You are able to do it with both frameworks but you likely won't. Most of the time they provide a bigger overhead than using Flask or Sinatra or going even more low level.</p>

<p>With a SOA you are basically free to use whatever you want and what works for the service you are building, you can even combine RoR and Django for one project - even if I would suggest  you stay with one language till you really need more performance or a certain feature that the language can deliver.</p>

<p>A small difference in the Rails and Django approach is something we should keep in mind. A typical RoR workflow, especially for people just starting out and not as experienced with the framework or web app development in general:</p>

<p>You need a model? <code>rails generate model foo â€¦</code>. Need a controller? <code>rails generate controller bar</code>. And you just continue creating new models and controllers till you wake up one day and see an app with 60 models, 80 controllers and the challenge to break out a certain functionality.</p>

<p>Do not be fooled, you can do the same thing in Django. But if you stick to the idea keeping as much of your project in small, easily exchangeable apps you could just take an app, move it in a new Django project on another server. This will not solve your scalability problems, this is not best practice and this should not be the default way doing things but you can do it if you really need to buy some time.</p>

<h2>One year laterâ€¦</h2>

<p>I still prefer Django. My main reason is still Python. I worked with both languages and frameworks the last year and I shipped projects in both of them. Give both of them a try and see what fits you better. Discussing the benefits and problems is like deciding if you take the Mercedes or BMW to drive your kids to school.</p>
</description>
                <pubDate>2013-08-13 19:24:00</pubDate>
            </item>
            
        
            
            <item>
                <title>I heard you like downloaders,</title>
                <link>http://screamingatmyscreen.com/2013/7/i-heard-you-like-downloaders/</link>
                <description><p>â€¦ so we put a downloader in your download to download a downloader to download the application you want. I have to admit that I do not like Adobe but they managed to move the current trend of downloading an application to download the application you want to a whole new level of stupidity.
<!--MORE--></p>

<p>If you want to install Photoshop with the current Creative Cloud system you have to login on the website to download Creative Cloud Desktop (let us call it CCD), you get CCDsetup. After that you download the CCDinstaller with the CCDsetup. When the download of CCDinstaller is finished CCDsetup notices that it is not running with administrator privileges, closes itself and gives you an error.</p>

<p>Rerun the program with sufficient privileges so it can download the whole setup <strong>again</strong> and install CCD. Now after you login in CCD you can download and install the Adobe application you want.</p>

<p>You could argue that this makes perfectly sense so your apps are up to date and synchronization with the cloud and stuff. But if you look at all the other tabs besides "application installation" in CCD the only thing you see is "coming soon". Not to speak of the fact that the last thing I want is anything else beside the apps from Adobe.</p>

<p>Look at Steam for example. It consolidates installations and the buying process from dozens of different vendors. This safes a lot of time, especially since buying games is a more frequent activity than buying Creative Suites.</p>

<p>I already have to create an account and enter my payment details, CCD does not save me from this. I upgrade once every year or every second to the next major release of Photoshop and the other apps. Login, download two or three different applications - if you do not just go for a suite - run a setup and done. No need to have another application in the middle of this process.</p>

<p>So I downloaded a downloader to download a setup wich installs a  downloader to download and install applications. Welcome in 2013.</p>
</description>
                <pubDate>2013-07-22 21:54:00</pubDate>
            </item>
            
        
            
            <item>
                <title>Is it stupid to pay for beautiful things?</title>
                <link>http://screamingatmyscreen.com/2013/7/is-it-stupid-to-pay-for-beautiful-things/</link>
                <description><p>Last week Amar Bose died. As expected a thread on every major discussion platform emerged. Sadly I have seen the same pointless discussion, as you would normally find in an Apple-centric thread, claiming that people buying Bose or Apple and paying for design are obviously stupid.
<!--MORE--></p>

<p>Every time I see this discussion I wonder how narrow minded people can be. I am aware that the "functionality and efficiency above everything" mantra is a valid attitude to life. What those people likely do not understand is that "I want beautiful things" is one, too.</p>

<h3>Speakers</h3>

<p>Would I buy Bose speakers if the sound quality would be absolutely horrible? And I mean horrible, not this "OMFG I am so audiophile, even bats are jealous of my hearing abilities" stuff every second self declared sound engineer posts to convince everyone how bad anything beside his favorite brand of headphones is. Of course not.</p>

<p>When I was 14 I told my dad that I wanted some speakers. After explaining some basics and things I should look for he took me to his shop and showed me a pair in every price segment and let me listen to them. One pair, Jamo 507, was exceptionally beautiful and the sound was great. He kept them as sample till I could pay the prime cost. Nearly two years later I could afford to buy them.</p>

<p>I could have bought cheaper speakers. I was not and I am nearly sure I am still not able to tell the difference after a certain point, my hearing just is not that good. But they looked and still look great. 13 years later I still enjoy listing to and looking at them. It was worth working a year longer to buy speakers which also look great.</p>

<h3>Hardware</h3>

<p>Depending on what I am currently doing and working on I am looking at my MacBook for 8 to 14 hours a day. Beside iOS development I could work with a Lenovo laptop e.x. But every time I look at a MacBook I see aluminum without gaps, a nice screen - you can call me crazy but I like the screen - and when I carry it around, start working or a presentation I see a beautiful piece of hardware in front of me.</p>

<p>I am aware that there are several other systems which are more powerful and have other advantages. But none of them comes near the beauty of a MacBook. I am willing to compromise on extensibility for a slimmer case. I am comfortable buying a new system when the old one is not fast enough anymore. From time to time the glossy screen annoys me, but it is so rarely that the joy of it while in my office or living room outweighs it.</p>

<p>I know that I can get a cheaper system which is as powerful as a MacBook but I still happily pay $1000 more to get one. Because it's beautiful, on top of all the functionality.</p>

<h3>Software</h3>

<p>For all those who prefer Emacs: You can just replace vim with Emacs in the following text. It does not make a difference.</p>

<p>I used vim for nearly eight years. But after I switched to OSX I started using Textmate. Currently I am using Sublime Text till Textmate 2 supports split windows.</p>

<p>The productivity decrease after switching to another editor was not significant. There were some things I was missing and they were easily available using plugins. Why did I switch to Textmate and why am I willing to do it again? Sublime Text provides all features I want.</p>

<p>It's about a native look and feel. Vim is ugly. Sublime Text does a better job but still does not provide a native look and feel. Every time I use them I am reminded that they are not first class citizens. They just do not match the rest of my system. This has nothing to do with productivity it is only a matter of aesthetics.</p>

<p>The same thing applies to many SaaSs. Why do people, after using both, choose service A over service B if they have nearly the same features? Why do some of them not even try both services after looking at the feature list and screenshots? One of them likely looks better, feels better or has a clearer workflow.</p>

<h2>Beauty is an important factor for my productivity</h2>

<p>If I can choose between two things which provide the same features I will always choose the one which is more beautiful. Even if I have to pay a premium for it. Could I get better speakers? Likely. Could I get a faster laptop? Of course. Would I be able to save 15 seconds a day using vim? Maybe. Does it make a difference for me? No.</p>

<p>I do not need speakers which can produce a sound only my dog can hear. I need some that produce a sound I like. I do not need the fastest machine available in front of me. I need one fast enough for everything I do. I do not need all features mankind can imagine in an editor. I need something to write Python, Ruby and Go.</p>

<p>But what I definitely need are beautiful things. I just feel better looking and things I like. If I like to interact with something I want to use it more often and I enjoy using it. If this describes the things I am using on a daily basis to make a living I happily pay a $1000 premium.</p>

<p>Everyone saying Bose, Apple and other brands are over-priced because you pay a premium for design will likely not understand my point of view. It is not about efficiency, it is not about something you can measure. It is about a feeling I have while interacting with something. </p>

<p>People use open source software because they believe in freedom, the spirit behind it and for many other reasons. People use proprietary software because it gets the job done, because they like the way it works or because they have to. What I am trying to communicate is that paying a premium to have beautiful things is the same as choosing open source or proprietary software. A choice about what you feel is important.</p>
</description>
                <pubDate>2013-07-18 18:15:00</pubDate>
            </item>
            
        
            
            <item>
                <title>Should I rewrite my app in Go for better scalability?</title>
                <link>http://screamingatmyscreen.com/2013/7/should-i-rewrite-my-app-in-go-for-better-scalability/</link>
                <description><p>In the past few months we have seen many articles about big companies and well known start-ups rewriting a part of their infrastructure in Go. And all articles have one thing in common. They tell you how much faster the app is, how many servers they could turn off and how awesome Go is. Should you do the same and rewrite your app in Go?
<!--MORE--></p>

<p>I have chosen the title because it is a questions I received two times now and I thought a bit longer answer could not hurt. The answer is sadly not just a simple 'yes' or 'no' but more an "it depends onâ€¦" type.</p>

<h2>Web development and Go</h2>

<p>There is a great number of different frameworks which are comparable to frameworks you likely know and have used. It starts with pretty simple stuff proving routing and sessions to full featured frameworks which position themselves as counterpart to Ruby on Rails or Django. You will also find libraries for nearly anything you can imagine.</p>

<p>The downside is that they are pretty young, not nearly as feature rich as the libraries you usually use with other languages and not always stable enough for production. If you heavily depend on third party libraries doing the majority of your work and are not willing to fix someone else's code or reinvent the wheel you will likely have a hard time using Go for bigger applications.</p>

<h2>Replacing a Ruby on Rails or Django application</h2>

<p>Do not do this. It is really that easy. If you have a non trivial application using multiple models, controllers and views  it will take a lot of time to rewrite everything and you will not have the same comfort as you have with those two frameworks. All the time you would waste for the rewrite could be invested in cleaning up your codebase, adding new features and improving the performance of your existing app.</p>

<p>The question is not if it is possible - but to answer it: yes, it is - the question is if it is a good idea and a good investment of your time.</p>

<h2>Start thinking SOA</h2>

<p>If you already have a service oriented architecture or if you are planning to split parts away from your gigantic application into smaller services you should consider using Go. I already deployed three services using it and I am quite satisfied with the results.</p>

<h3>From Flask to Gorilla</h3>

<p>There was a service which I hacked together in two or three hours. Nothing impressive. It did three things:</p>

<ol>
<li>Receive data (http POST / JSON)</li>
<li>Store data (redis)</li>
<li>On request process data and send it (http GET / JSON)</li>
</ol>

<p>The service is nothing spectacular or impressive and I believe everyone who is not drunk and has used Python and Flask for more than three hours would have been able to implement it. It is in production for nearly a year and works flawless, but more people started using it and the server sees a lot of load recently, sometimes taking more time than acceptable to respond to requests.</p>

<p>The easy solution would be moving redis to its own server and adding a second application server. I decided to rewrite it in Go. It took a bit more time, but it worked. After I flipped the switch and put it in production the server load moved down, response times got faster and looking at the load it could even be deployed to a smaller server.</p>

<h3>heroku ps:scale web=+2</h3>

<p>In January a friend asked me to help him with a project. He and his company were a bit behind the timeline and they could not afford to be late with this one. They had a solid codebase and already used a SOA. I worked on two services.</p>

<p>Last month we met for a coffee and talked about the Flask application I recently replaced. He was curious why the service was down the first time in a year. He thought about hiring me to replace some of the services with a rewrite in Go. After a short talk about the advantages and disadvantages we came to the conclusion that it would be best to just add additional dynos.</p>

<p>First let us start with some simple math. Two additional Heroku dynos cost them $71 / month. If he would hire me to replace a service we would talk about ~$100 / hour (roughly, we bill each other in Euro). The services are far from trivial, but for the sake of those who do not like complex math imagine I would only need one day to write, test and deploy one service. Two days, with 8 hours of work, are $1600. For this amount of money they could pay the two additional dynos for two years. But what if they unexpectedly need to scale further? Let us add two additional dynos bringing us to $143 / month. We are still around a year of Heroku costs vs development costs.</p>

<p>Another thing to factor in is that neither he nor one of his employees is currently using Go or planning to learn it. Extending or fixing something on one of the services would lead to additional costs.</p>

<h3>When I would consider using Go</h3>

<p>If I would start from scratch or add a new service to an existing infrastructure - and if more people are working on a project someone beside me is familiar with Go - I would not hesitate using it if I would not need many third party libraries.</p>

<h2>Stop talking about scalability and start thinking about costs</h2>

<p>There are some <a href="http://www.techempower.com/benchmarks/#section=data-r6">impressive benchmarks</a> clearly showing what Go is capable of. What some people seem to miss is the fact that more requests per second does not mean it scales better. It just means you can process more requests per second and have to worry about scaling later than sooner.</p>

<p>It is possible that your database will be the bottleneck before you need additional application servers, it could be possible that you will be IO bound but just processing more req/s will not save you from the fact that you need a plan for scaling and in an ideal world a clean codebase enabling you to do so.</p>

<p>What you really should consider, especially if you are just starting with the development of the next world disrupting, society changing, kitten picture sharing service, is the costs associated with developing and running the service. If you cannot afford the server costs all your work, your scaling strategy and everything else is worth nothing.</p>

<p>Most people choose to use Ruby on Rails or Django for a minimal viable product. Fast to develop in, many libraries, cheap contractors, support by many big hosting providers, lots of tutorials,â€¦ There are many advantages. But what would you gain if you invest a bit more time in your MVP?</p>

<p>We all know benchmarks suck and we should ignore them but let us assume that Go performs three times better than the same application written in another language. If only half of the benchmarks we have seen are not entirely wrong this should be a safe assumption.</p>

<p>Your typical stack to start with likely looks like this. One server for your app, one for your database. You could put both on the same system but you want to be on the safe side when the millions of cat lovers storm your service. Now someone tells you you should have some backup system if there goes something wrong. You add another app server and a database server. You are successful. More and more users joins your service so you start adding app servers.</p>

<p>This is exactly the moment where it would pay off if you would have invested more time in your MVP. While your typical app can handle 5000 users with one server your Go app now handles 15000. If you are growing fast this can be a lot of money you will safe.</p>

<h3>At least in theory</h3>

<p>Please remember I am not telling you to use Go, no matter what. I am not advocating to throw away RoR or Django. I am not even saying that those benchmarks and theoretical numbers can be reached. We just do not have enough data and real wold examples to prove anything.</p>

<p>And while "invest more time" does sound like an okay tradeoff you should remember that Go and its libraries are young. If do not already now what you will be using, maybe played around with it and have a vague idea if you would have to implement fifty percent of the features you expect from your ORM yourself you could have a bad time seeing a competitor releasing "your product" after a night of heavy drinking and writing PHP.</p>

<p>If you are just starting your future career as developer and want to decide which language you should learn I would suggest you go for Ruby or Python. They are both mainstream and if your kitten picture sharing service does not take off you can easily find a job or some freelance work to make some money for your next ground braking idea.</p>

<h2>Conclusion</h2>

<p>Go is a solid choice. After getting used to it you can likely write code as fast as in another language, it has a promising community and libraries are slowly maturing. While Go itself is pretty robust and feature complete you will have to invest time and effort if you are planning to use third party libraries.</p>

<p>You can succeed and gain many advantages if you choose Go, you can end up with a horrible mess and hate yourself every day for doing something unbelievable stupid.</p>

<p>You should carefully consider your options and the pros and cons. I am currently happy with Go and I will continue using it when it is appropriate but it is not the last language I will ever use and it is not the right tool for every project.</p>
</description>
                <pubDate>2013-07-03 19:32:00</pubDate>
            </item>
            
        
            
            <item>
                <title>http.Request and goroutines</title>
                <link>http://screamingatmyscreen.com/2013/6/http-request-and-goroutines/</link>
                <description><p>I was starting to write a web service using Go this weekend. I already deployed two services replacing a Flask and a Sinatra application but this time was different. It was the first time I found a part in the Go language which did not make sense immediately. Did you ever try to pass a http.Request to a goroutine? Do you want to know what happens if you do?
<!--MORE--></p>

<p>For me, the hardest part using a new language or framework is always the little differences between them and being a bit opinionated after all the years of writing code in different languages. This weekend I encountered the first thing in Go which did not seem right. After some discussions in #go-nuts I understood the issue but I am still not entirely sold on the way it works.</p>

<p>Just as a short side note before we start looking at the code I want to mention that the people in #go-nuts are great. It is one of the really helpful channels on FreeNode and one of the most newbie friendliest ones I am aware of.</p>

<h2>Return as fast as possible</h2>

<p>I want to replace an existing service which does just one simple thing. Accept a CORS request, process some data and save it to the database. The client does not need to know if it succeeded or anything else. It is basically fire and forget.</p>

<p>For simplicity we just use curl to post some data</p>

<pre><code>curl -i http://localhost:8080/api/add --data "foo=bar"
</code></pre>

<p>Since the client does not need to know what happens to our data we should finish the request as fast as possible. Goroutines are great and this is one of the cases where they are the right tool to use.</p>

<p>If the processing is done outside the request handler it should be able to return nearly immediately since spinning up a goroutine is insanely fast. The final service could use channels and be a bit more sophisticated but I wanted to extend it slowly.</p>

<pre><code>package main

import (
    "github.com/gorilla/mux"
      "log"
    "net/http"
    "time"
)

func main() {
    log.Println("Starting server...")

    router := mux.NewRouter()
    router.HandleFunc("/api/add", AddHandler).Methods("POST")

    http.Handle("/api/", router)

    log.Println("Now listening on port 8080")
    http.ListenAndServe(":8080", nil)
}

func AddHandler(respWriter http.ResponseWriter, request *http.Request) {
    respWriter.Header().Set("Content-Type", "application/json")
    go PrintStuff(request)
    respWriter.Write([]byte("Thanks\n"))
}

func PrintStuff(request *http.Request) {
    request.ParseForm()
    time.Sleep(time.Second * 3)
    log.Println(request.PostForm)
}
</code></pre>

<p>Pretty obvious code, isn't it? We spin up a go routine and return a "Thanks". Let us look at the output</p>

<pre><code>envy% go run src/apiserver/server1.go
2013/06/19 17:58:18 Starting server...
2013/06/19 17:58:18 Now listening on port 8080
2013/06/19 17:58:23 map[]
</code></pre>

<p>Why is our map empty? We posted <code>foo=bar</code>! The problem is that the request body is closed, the handler finished executing before our goroutine started processing everything. (At least this is the final explanation I got. If this is still not entirely correct please send me a mail or tweet so I can update the post)</p>

<p>Calling <code>ParseForm()</code> before spinning up the goroutine on the other hand works fine. First we change our code</p>

<pre><code>func AddHandler(respWriter http.ResponseWriter, request *http.Request) {
    respWriter.Header().Set("Content-Type", "application/json")
    request.ParseForm()
    go PrintStuff(request)
    respWriter.Write([]byte("Thanks\n"))
}

func PrintStuff(request *http.Request) {
    time.Sleep(time.Second * 3)
    log.Println(request.PostForm)
}
</code></pre>

<p>And after running curl we should see</p>

<pre><code>envy% go run src/apiserver/server1.go
2013/06/19 18:04:21 Starting server...
2013/06/19 18:04:21 Now listening on port 8080
2013/06/19 18:04:26 map[foo:[bar]]
</code></pre>

<p>Now this solves our problem, right? Kind of but not in an elegant way.</p>

<h3>Half usable request</h3>

<p>This is the part I do not like. I cannot call <code>ParseForm()</code> but I can access <code>PostForm</code>. I would prefer an all or nothing approach. </p>

<p>I am also not sure if everyone would come to the conclusion why this happens after "just" reading the documentation. The last part of the <code>Handler</code> interface gives a hint but neither <code>http.Request</code> nor <code>ParseForm()</code> mention anything related. It is possible that I missed something or just read it wrong but judging from the reactions I got after asking about this my idea was not so obscure.</p>

<p>As I said it may be a problem with being opinionated and having seen other frameworks and languages with a different behavior. I still believe that if I can do "a" I should be able to do "b" on a struct.</p>

<h3>A better solution</h3>

<p>I do not talk about best practices, I am not experienced enough with Go to do that, but I think you should just ignore the request outside the handler. If only some things are possible you should consider it gone. So we have to pass our data to the goroutine in a different way.</p>

<p>Using a simple map our code would look like this</p>

<pre><code>func AddHandler(respWriter http.ResponseWriter, request *http.Request) {
    respWriter.Header().Set("Content-Type", "application/json")
    request.ParseForm()

    body := make(map[string][]string)
    body["foo"] = request.PostForm["foo"]
    go PrintStuff(body)

    respWriter.Write([]byte("Thanks\n"))
}

func PrintStuff(body map[string][]string) {
    time.Sleep(time.Second * 3)
    log.Println(body)
}
</code></pre>

<p>And let us look at the output</p>

<pre><code>envy% go run src/apiserver/server1.go
2013/06/19 18:26:51 Starting server...
2013/06/19 18:26:51 Now listening on port 8080
2013/06/19 18:26:58 map[foo:[bar]]
</code></pre>

<p>As expected. Moral of the story? Do not pass a request to a goroutine.</p>
</description>
                <pubDate>2013-06-19 21:02:00</pubDate>
            </item>
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    </channel>

</rss>